{{ define "main" }}
<article class="page speakers-page">
  <div class="container">
    <h1>{{ .Title }}</h1>
    {{ .Content }}

    {{/* Collect all unique speaker names first */}}
    {{ $speakerNames := slice }}
    {{ range .Site.Data.talks }}
      {{ range .events }}
        {{ if .talks }}
          {{ range .talks }}
            {{ if .speaker }}
              {{ $speakerNames = $speakerNames | append .speaker }}
            {{ end }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{ $speakerNames = $speakerNames | uniq | sort }}

    <p class="speaker-count"><strong>{{ len $speakerNames }}</strong> speakers since 1986</p>

    <div class="speaker-list">
      {{ range $speakerNames }}
        {{ $currentSpeaker := . }}
        <div class="speaker-entry">
          <h3 class="speaker-name">{{ $currentSpeaker }}</h3>
          <ul class="speaker-talks">
            {{/* Find all talks by this speaker */}}
            {{ range $.Site.Data.talks }}
              {{ $year := .year }}
              {{ range .events }}
                {{ if .talks }}
                  {{ range .talks }}
                    {{ if eq .speaker $currentSpeaker }}
                    <li>
                      <span class="talk-year">{{ $year }}</span>
                      <span class="talk-title">{{ .title }}</span>
                    </li>
                    {{ end }}
                  {{ end }}
                {{ end }}
              {{ end }}
            {{ end }}
          </ul>
        </div>
      {{ end }}
    </div>
  </div>
</article>
{{ end }}
